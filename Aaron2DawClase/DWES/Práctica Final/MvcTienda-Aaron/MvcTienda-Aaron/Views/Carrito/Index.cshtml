@model MvcTienda_Aaron.Models.Pedido;
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1 class="text-center text-brown">Carrito</h1>

<div class="row">
    <div class="col-lg-6 border rounded shadow p-3">
        <h5>Núm. Pedido: @Html.DisplayFor(model => model.Id)</h5>
        <h5>
            Fecha de entrega:  @{
                DateTime fechaActual = (DateTime.Now.AddDays(5));
                string fechaEntrega = fechaActual.ToString("dddd dd MMMM", System.Globalization.CultureInfo.CreateSpecificCulture("es-MX"));
            }
            @fechaEntrega
        </h5>
        <h5> @Html.DisplayNameFor(model => model.Cliente.Nombre): @Html.DisplayFor(model => model.Cliente.Nombre)</h5>
        <h5>@Html.DisplayNameFor(model => model.Cliente.Direccion): @Html.DisplayFor(model => model.Cliente.Direccion)</h5>
        <h5>@Html.DisplayNameFor(model => model.Cliente.Poblacion): @Html.DisplayFor(model => model.Cliente.Poblacion)</h5>
    </div>
</div>

<table class="table border-bottom text-center align-items-center align-content-center justify-content-center">

    <tr>
        <th>
        </th>
        <th>
            Descripción del producto
        </th>
        <th>
            Cantidad
        </th>
        <th>
            Precio
        </th>
        <th>
            Descuento
        </th>
        <th>
            Total
        </th>
        <th>
        </th>
    </tr>

    @foreach (var item in Model.Detalles)
    {
        <tr >
            <td >
                @{
                    var nombreImagen = "imagen-no-disponible.jpg";
                    if (item.Producto.Imagen != null)
                    {
                        nombreImagen = item.Producto.Imagen;
                    }
                }
                <img style="width:300px; height:300px;" src="~/images/@nombreImagen" alt="No funciona" asp-append-version="true" />
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Producto.Descripcion)
            </td>
            <td>
                
                @if (item.Cantidad <= 1)
                {
                    <a asp-action="MenosCantidad" asp-controller="Carrito" asp-route-id="@item.Id" class="btn btn-outline-dark disabled btn-sm" >-</a>
                }
                else
                {
                    <a asp-action="MenosCantidad" asp-controller="Carrito" asp-route-id="@item.Id" class="btn btn-dark btn-sm">-</a>
                }
            
                        @Html.DisplayFor(modelItem => item.Cantidad)
             
                @if (item.ProductoTalla.Stock == item.Cantidad)
                {
                    <a asp-action="MasCantidad" asp-controller="Carrito" asp-route-id="@item.Id" class="btn btn-outline-dark disabled btn-sm">+</a>
                }
                else
                {
                    <a asp-action="MasCantidad" asp-controller="Carrito" asp-route-id="@item.Id" class="btn btn-dark btn-sm">+</a>
                }
           
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Producto.Precio) €
            </td>
            <td>
                0,00
            </td>
            <td>
                @{
                    decimal precio = 0;
                    decimal total = 0;


                    precio = item.Precio * item.Cantidad;

                    total = total + precio;
                }
                <p>@precio</p>
            </td>

            <td >
                <form asp-action="EliminarLinea">
                    <input class="btn btn-danger" type="submit" value="Eliminar" asp-action="EliminarLinea" asp-controller="Carrito" asp-route-id="@item.Id" />
                </form>
            </td>
        </tr>
    }
    @{
        decimal totalProducto = 0;
        decimal totalFinal = 0;
    }
    <br />

    <h5>Total:</h5>

    @foreach (var item in Model.Detalles)
    {
        totalProducto = item.Precio * item.Cantidad;
        totalFinal = totalFinal + totalProducto;
    }
    <p>@totalFinal</p>



    <form asp-action="ConfirmarPedido" class="container-fluid text-center">
        <input class="btn btn-success" type="submit" value="Confirmar Pedido" asp-action="ConfirmarPedido" asp-controller="Carrito" asp-route-id="@Model.Id" />
    </form>


</table>


<br />
<br />
<br />
<br />
<a asp-action="Index" asp-controller="Escaparate">Seguir Comprando</a>

